CHR закончили утром (когда меня не было :().

Сейчас идём по книжке "Term Rewriting and all that" Franz Baader, Tobias Nipkow.

Принцип well-founded induction: если у нас есть бинарное отношение `->`
на множестве A, то если мы знаем, что для любого x верно следствие
"для любого `y`, достижимого из `x` по стрелочкам за конечное число шагов, `P(y)`" => `P(x)`,
то `P(x)` верно для произвольного `x`. Сюда зарыты и база, и переход.

Давайте разберёмся, когда этим можно пользоваться.
Утверждение: тогда и только тогда, когда `->` терминируемо (т.е. не существует бесконечных цепей).
В одну сторону: если терминируемо и посылка верна, но есть `x`, для которого `!P(x)`,
то можно применить предположение для него, если не получилось - найти какой-то
достижимый из него, снова попробовать, в худшем случае найдём бесконечную цепь.
В другую сторону: докажем по индукции "`P(x)` = из `x` нет бесконечных путей".

Теперь занимаемся системами переписывания.
Если система нетерминируема, то нам очень-очень плохо и надо стараться сделать её терминируемой.

Повводим каких-нибудь определений конфлюэнтности.
## Локальная конфлюэнтность (local confluence)
Если у нас из `x` есть одна стрелочка в `y_1` и одна в `y_2`, то `y_1 (стрелочка вниз) y_2`,
т.е. есть по цепочке из `y_1` и `y_2` в какой-то общий `y'`.

Пример локально конфлюэнтной системы:
```
a <-- 0 <--> 1 --> b
```
Тогда в качестве `x` можем взять либо `0`.
У него нет нормальной формы => нет обычной конфлюэнтности.
Но есть локальная.

Интуиция: если ориентированный граф в каком-то смысле связен и у него два тупика, то конфлюэнтности наверняка нет.
Ещё замечание: эта система нетерминируема.

Теорема: для терминируемых систем локальная конфлюэнтность <=> конфлюэнтность.
Доказательство по well-founded induction и локальной конфлюэнтности.

## Строгая конфлюэнтность
Если у нас из `x` есть одна стрелочка в `y_1` и одна в `y_2`, то `y_1 (стрелочка вниз) y_2`,
т.е. есть по цепочке из `y_1` и `y_2` в какой-то общий `y'`, причём одна из них длиной не более единицы.

Теорема: докажем, что из строгой конфлюэнтности следует полуконфлюэнтность.
Полуконфлюэнтность: если из `x` за одну стрелочку следует `y_1`, а за много - `y_2`, то `y_1<стрелочка вниз>y_2`.

## Diamond property
Если есть одна стрелочка `y_1 <- x -> y_2`, то есть такое `z`, что `y_1 -> z <- y_2`.
Из него следует конфлюэнтность.
Если транзитивно замкнуть конфлюэнтное отношение, то получим diamond property.

## Какие вообще есть следствия
```
D.P. => C
LC ===> C (при условии терминируемости)
C ~~~ Church-Rosser
C ~~~ SemiC ~~~ Strong CHR
```

## Замечания
1. Если у нас есть два отношения с одинаковым замыканием, то если в одном есть diamond property, то в другом есть конфлюэнтность.
2. Если есть `->_1 \subseteq ->_2 \subseteq ->_1^*`, то транзитивные замыкания `->_1` и `->_2` равны.

# Системы переписывания
Наблюдение: порядочная система переписывания не вводит свободные переменные при переписывании.
То есть в правиле `L -> R` справа нет свободных переменных, которых нет слева.

Дальше мы ввели определение "критической пары".
Берём два правила `l_1 -> r_1` и `l_2 -> r_2` (без общих переменных, иначе переименуем).
Находим подтерм `l_1`, унифицируем с `l_2`, получили терм `t`.
Дальше заменили в `t` `l_1` на `r_1`, а `l_2` на `r_2`, получили
два терма (возможно, одинаковые), вот они и образуют критическую пару.

Теорема: система локально конфлюэнтна <=> все критические пары "сводимы".
Т.е. их можно, применяя правила, свести к одному.
